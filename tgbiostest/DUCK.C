#include "DUCK.H"

int duckywid=32;
int duckyhei=32;
// 15-bit RGBA
unsigned short duck16[32*32]={
     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,     0,     0,     0,     0,     0, 12672, 19008, 22176, 22176, 22176, 21120, 10560,     0,     0,
     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,     0,     0,     0,     0, 16896, 23232, 26400, 27456, 28512, 27456, 26400, 23232, 19008,     0,
     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,     0,     0,     0, 14784, 21120, 25344, 28512, 29568, 30624, 30624, 29568, 28512, 24288, 17952,
     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,     0,     0,  2112, 20064, 24288, 27456, 30624, 31680, 32736, 32736, 31680, 29568, 27456, 22176,
 14784,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,     0,     0, 13728, 21120,    27,    27, 31681, 32744, 32745, 32737, 31680, 30624, 28512, 24288,
 19008,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,     0,     0, 16896, 21120,    24,    27, 31681, 32748, 32755, 32749, 32741, 31680, 29568, 26400,
 20064,  8448,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,     0,     0, 17952, 22176,    24,    26, 31681, 32748, 32759, 32760, 32749, 32738, 28512, 25344,
 20064, 12672,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,     0,  5509,  8775, 23232, 24288, 26400, 28512, 31682, 32748, 32754, 32752, 32741, 27456, 24288,
 20064, 12672,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,     0,  6630,  8808, 10985, 11050, 24288, 26400, 27456, 29569, 32745, 32743, 31685, 26400, 22176,
 17952,  9504,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,  5509,  6630,  7719,  8807,  9864,  9929, 24288, 26400, 26400, 27456, 26400, 25344, 23232, 19008,
 14784,  6336,     0,     0,     0,     0,     0,     0, 14784, 14784,     0,     0,     0,     0,     0,     0,
     0,     0,  3299,  4420,  5477,  6565,  6630,  7719, 21120, 22176, 23232, 24288, 23232, 22176, 20064, 15840,
 11616,     0,     0,     0,     0,     0,     0, 17952, 17952, 16896, 16896,     0,     0,     0,     0,     0,
     0,     0,     0,     0,  1121,  2210,  9504, 12672, 16896, 19008, 20064, 20064, 20064, 17952, 16896, 17952,
 14784, 14784, 17952, 17952, 17952, 17952, 17952, 17952, 17952, 17952, 17952, 17952,     0,     0,     0,     0,
     0,     0,     0,     0,     0,  4224,  8448, 12672, 14784, 16896, 17952, 20064, 22176, 23232, 24288, 24288,
 21120, 23232, 23232, 22176, 22176, 22176, 22176, 22176, 22176, 22176, 22176, 22176, 17952,     0,     0,     0,
     0,     0,     0,     0,     0,     0, 10560, 16896, 20064, 23232, 24288, 25344, 27456, 29568, 30624, 29568,
 28512, 28512, 28512, 28512, 27456, 26400, 26400, 26400, 26400, 25344, 25344, 23232, 21120,     0,     0,     0,
     0,     0,     0,     0,     0,     0, 12672, 19008, 24288, 27456, 29569, 29569, 30625, 32738, 32737, 31680,
 30624, 29568, 29568, 29568, 29568, 29568, 29568, 29568, 28512, 27456, 25344, 22176, 20064, 15840,     0,     0,
     0,     0,     0,     0,     0, 11616, 19008, 23232, 26400, 29568, 31682, 32738, 32739, 32739, 32738, 32737,
 32737, 31680, 31680, 31680, 30624, 30624, 30624, 29568, 28512, 27456, 25344, 22176, 20064, 16896,     0,     0,
     0,     0,     0,     0,  8448, 19008, 23232, 25344, 28512, 30625, 32739, 32740, 32740, 32740, 32739, 32738,
 32738, 32737, 32736, 32736, 31680, 30624, 29568, 29568, 28512, 27456, 25344, 22176, 20064, 16896, 13728,     0,
     0,     0,     0,     0, 17952, 22176, 24288, 27456, 30625, 32738, 32740, 32741, 32742, 32741, 32740, 32739,
 32738, 32737, 32736, 31680, 30624, 30624, 29568, 28512, 27456, 27456, 25344, 23232, 20064, 16896, 13728,     0,
     0,     0,     0,  2112, 20064, 23232, 26400, 28512, 30625, 32738, 32740, 32741, 32741, 32740, 32739, 32738,
 32737, 31680, 31680, 30624, 30624, 29568, 28512, 28512, 27456, 26400, 25344, 23232, 20064, 14784,  9504,     0,
     0,     0,     0, 13728, 19008, 22176, 25344, 28512, 29568, 31681, 32738, 32740, 32740, 32739, 32738, 32737,
 31680, 30624, 30624, 29568, 29568, 28512, 27456, 27456, 26400, 25344, 25344, 21120, 16896, 11616,     0,     0,
     0,     0,     0, 15840, 19008, 21120, 24288, 27456, 28512, 29568, 31681, 32738, 32739, 32738, 32737, 31680,
 30624, 29568, 29568, 28512, 28512, 27456, 26400, 26400, 24288, 23232, 22176, 17952, 12672,  7392,     0,     0,
     0,     0,     0, 14784, 17952, 21120, 23232, 26400, 27456, 28512, 29568, 31681, 32738, 31681, 30624, 30624,
 29568, 28512, 28512, 27456, 27456, 25344, 24288, 23232, 22176, 20064, 17952, 14784,  8448,  3168,     0,     0,
     0,     0,     0, 14784, 16896, 20064, 23232, 25344, 26400, 27456, 28512, 29568, 31681, 30624, 29568, 29568,
 28512, 27456, 26400, 25344, 24288, 23232, 22176, 20064, 19008, 16896, 14784, 10560,  5280,     0,     0,     0,
     0,     0,     0, 12672, 15840, 19008, 22176, 24288, 25344, 26400, 27456, 28512, 29568, 28512, 27456, 26400,
 25344, 24288, 23232, 22176, 21120, 20064, 19008, 16896, 14784, 13728, 12672,  8448,  3168,     0,     0,     0,
     0,     0,     0,  9504, 12672, 15840, 19008, 22176, 23232, 24288, 25344, 26400, 26400, 25344, 24288, 22176,
 22176, 21120, 20064, 20064, 19008, 16896, 15840, 13728, 12672, 11616,  9504,  5280,     0,     0,     0,     0,
     0,     0,     0,     0,  9504, 12672, 15840, 19008, 20064, 21120, 22176, 22176, 22176, 21120, 20064, 20064,
 19008, 17952, 16896, 15840, 14784, 13728, 12672, 11616, 10560,  8448,  7392,     0,     0,     0,     0,     0,
     0,     0,     0,     0,  6336,  9504, 12672, 15840, 17952, 17952, 19008, 19008, 19008, 17952, 16896, 15840,
 14784, 13728, 13728, 12672, 11616,  9504,  8448,  7392,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,     0,     0,  3168,  6336,  9504, 12672, 14784, 14784, 14784, 14784, 13728, 12672, 12672, 11616,
 10560, 10560,  9504,  8448,  7392,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,     0,     0,     0,  3168,  5280,  7392,  9504, 10560, 10560,  9504,  8448,  7392,  6336,  5280,
  5280,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,     0,     0,     0,     0,  1056,  3168,  5280,  6336,  5280,     0,     0,     0,     0,     0,
     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
};

static unsigned int MakeRGB(unsigned char r,unsigned char g,unsigned char b)
{
	return b|(r<<8)|(g<<16);
}

void MakeDuck256(unsigned int palette[513],unsigned char ptn[32*32])
{
	unsigned int i,used=0;
	palette[0]=256;
	for(i=0; i<duckywid*duckyhei; ++i)
	{
		unsigned int r,g,b,j,rgb;
		g=(duck16[i]>>10);
		r=(duck16[i]>>5)&0x1F;
		b= duck16[i]&0x1F;

		g=(g<<3)|(g>>2);
		r=(r<<3)|(r>>2);
		b=(b<<3)|(b>>2);

		rgb=MakeRGB(r,g,b);

		for(j=0; j<used; ++j)
		{
			if(palette[1+j*2+1]==rgb)
			{
				ptn[i]=palette[1+j*2];
				goto NEXTI;
			}
		}

		if(used<256)
		{
			palette[1+used*2]=used;
			palette[2+used*2]=rgb;
			ptn[i]=used;
			++used;
		}
		else
		{
			ptn[i]=0;
		}

	NEXTI:
		;
	}

	palette[0]=used;
}

void MakeDuck4(unsigned int palette[513],unsigned char ptn[16*32])
{
	unsigned int i,used=0;
	palette[0x00]=16;
	palette[0x01]= 0;   palette[0x02]=MakeRGB(0,0,0);
	palette[0x03]= 1;   palette[0x04]=MakeRGB(0,0,128);
	palette[0x05]= 2;   palette[0x06]=MakeRGB(0,128,0);
	palette[0x07]= 3;   palette[0x08]=MakeRGB(0,128,128);
	palette[0x09]= 4;   palette[0x0A]=MakeRGB(128,0,0);
	palette[0x0B]= 5;   palette[0x0C]=MakeRGB(128,0,128);
	palette[0x0D]= 6;   palette[0x0E]=MakeRGB(128,128,0);
	palette[0x0F]= 7;   palette[0x10]=MakeRGB(128,128,128);
	palette[0x11]= 8;   palette[0x12]=MakeRGB(160,160,160);
	palette[0x13]= 9;   palette[0x14]=MakeRGB(0,0,255);
	palette[0x15]=10;   palette[0x16]=MakeRGB(0,255,0);
	palette[0x17]=11;   palette[0x18]=MakeRGB(0,255,255);
	palette[0x19]=12;   palette[0x1A]=MakeRGB(255,0,0);
	palette[0x1B]=13;   palette[0x1C]=MakeRGB(255,0,255);
	palette[0x1D]=14;   palette[0x1E]=MakeRGB(255,255,0);
	palette[0x1F]=15;   palette[0x20]=MakeRGB(255,255,255);

	for(i=0; i<duckywid*duckyhei; ++i)
	{
		int r,g,b,j,minDist,minColor;
		g=(duck16[i]>>10);
		r=(duck16[i]>>5)&0x1F;
		b= duck16[i]&0x1F;

		g=(g<<3)|(g>>2);
		r=(r<<3)|(r>>2);
		b=(b<<3)|(b>>2);

		minDist=0x7FFFFFFF;
		minColor=0;
		for(j=0; j<16; ++j)
		{
			int R,G,B,dr,dg,db,dist;
			G=(palette[1+j*2+1]>>16)&255;
			R=(palette[1+j*2+1]>>8)&255;
			B= palette[1+j*2+1]&255;

			dg=G-g;
			dr=R-r;
			db=B-b;
			dist=dg*dg+dr*dr+db*db;

			if(dist<minDist)
			{
				minColor=j;
				minDist=dist;
			}
		}

		if(0==(i&1))
		{
			ptn[i/2]=minColor;
		}
		else
		{
			ptn[i/2]|=(minColor<<4);
		}
	}
}
