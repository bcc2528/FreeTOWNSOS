						.386p

						ASSUME CS:CODE

BIOSERR_INVALID_REQUEST	EQU		0FFh

						EXTRN EGB_INIT:NEAR
						EXTRN EGB_RESOLUTION:NEAR
						EXTRN EGB_DISPLAYSTART:NEAR
						EXTRN EGB_VIEWPORT:NEAR
						EXTRN EGB_PALETTE:NEAR
						EXTRN EGB_WRITEPAGE:NEAR
						EXTRN EGB_DISPLAYPAGE:NEAR
						EXTRN EGB_COLOR:NEAR
						EXTRN EGB_COLORIGRB:NEAR
						EXTRN EGB_PASTEL:NEAR
						EXTRN EGB_WRITEMODE:NEAR
						EXTRN EGB_LINEPATTERN:NEAR
						EXTRN EGB_PAINTMODE:NEAR
						EXTRN EGB_HATCHINGPATTERN:NEAR
						EXTRN EGB_TILEPATTERN:NEAR
						EXTRN EGB_MASKREGION:NEAR
						EXTRN EGB_MASK:NEAR
						EXTRN EGB_PEN:NEAR
						EXTRN EGB_PENSIZE:NEAR
						EXTRN EGB_PENSTYLE:NEAR
						EXTRN EGB_MASKBIT:NEAR
						EXTRN EGB_TEXTDIRECTION:NEAR
						EXTRN EGB_TEXTDISPLAYDIRECTION:NEAR
						EXTRN EGB_TEXTSPACE:NEAR
						EXTRN EGB_TEXTZOOM:NEAR
						EXTRN EGB_FONTSTYLE:NEAR
						EXTRN EGB_SUPERIMPOSE:NEAR
						EXTRN EGB_DIGITIZE:NEAR
						EXTRN EGB_RESOLUTION_BY_HANDLE:NEAR
						EXTRN EGB_CLEARSCREEN:NEAR
						EXTRN EGB_PARTCLEARSCREEN:NEAR
						EXTRN EGB_GETBLOCKCOLOR:NEAR
						EXTRN EGB_PUTBLOCKCOLOR:NEAR
						EXTRN EGB_GETBLOCK:NEAR
						EXTRN EGB_PUTBLOCK:NEAR
						EXTRN EGB_GETBLOCKZOOM:NEAR
						EXTRN EGB_PUTBLOCKZOOM:NEAR
						EXTRN EGB_GRAPHICCURSOR:NEAR
						EXTRN EGB_MASKDATA:NEAR
						EXTRN EGB_SCROLL:NEAR
						EXTRN EGB_PARTSCROLL:NEAR
						EXTRN EGB_REGION:NEAR
						EXTRN EGB_COPY:NEAR
						EXTRN EGB_ROTATE:NEAR
						EXTRN EGB_RESOLVE:NEAR
						EXTRN EGB_PSET:NEAR
						EXTRN EGB_CONNECT:NEAR
						EXTRN EGB_UNCONNECT:NEAR
						EXTRN EGB_POLYGON:NEAR
						EXTRN EGB_ROTATEPOLYGON:NEAR
						EXTRN EGB_TRIANGLE:NEAR
						EXTRN EGB_RECTANGLE:NEAR
						EXTRN EGB_CIRCLE:NEAR
						EXTRN EGB_ARC:NEAR
						EXTRN EGB_FAN:NEAR
						EXTRN EGB_ELLIPSE:NEAR
						EXTRN EGB_ELLIPTICARC:NEAR
						EXTRN EGB_ELLIPTICFAN:NEAR
						EXTRN EGB_PAINT:NEAR
						EXTRN EGB_CLOSEPAINT:NEAR
						EXTRN EGB_POINT:NEAR
						EXTRN EGB_BOW:NEAR
						EXTRN EGB_BOW2:NEAR
						EXTRN EGB_SJISSTRING:NEAR
						EXTRN EGB_CONNECTSJISSTRING:NEAR
						EXTRN EGB_ASCIISTRING:NEAR
						EXTRN EGB_CONNECTASCIISTRING:NEAR
						EXTRN EGB_JISSTRING:NEAR
						EXTRN EGB_CONNECTJISSTRING:NEAR
						EXTRN EGB_ANYCHAR:NEAR
						EXTRN EGB_UNSUPPORTED:NEAR

						EXTRN SPR_INIT:NEAR
						EXTRN SPR_DISPLAY:NEAR
						EXTRN SPR_DEFINE:NEAR
						EXTRN SPR_SETPALETTEBLOCK:NEAR
						EXTRN SPR_SETPOSITION:NEAR
						EXTRN SPR_SETATTRIBUTE:NEAR
						EXTRN SPR_SETMOTION:NEAR
						EXTRN SPR_SETOFFSET:NEAR
						EXTRN SPR_READATTRIBUTE:NEAR

						; EXTRN	MOS_ENTRY:NEAR
						; EXTRN	SPR_ENTRY:NEAR
						; EXTRN	SND_ENTRY:NEAR
						; EXTRN	FNT_ENTRY:NEAR
						; EXTRN	MIDI_ENTRY:NEAR
						; EXTRN	SNDINT_ENTRY:NEAR
						; EXTRN SYSINFO_ENTRY:NEAR

						EXTRN SND_INIT:NEAR
						; What about SND_END?
						EXTRN SND_KEY_ON:NEAR
						EXTRN SND_KEY_OFF:NEAR
						EXTRN SND_PAN_SET:NEAR
						EXTRN SND_INST_CHANGE:NEAR
						EXTRN SND_INST_WRITE:NEAR
						EXTRN SND_INST_READ:NEAR
						EXTRN SND_PITCH_CHANGE:NEAR
						EXTRN SND_VOLUME_CHANGE:NEAR
						EXTRN SND_KEY_ABORT:NEAR
						EXTRN SND_STATUS:NEAR
						EXTRN SND_FM_READ_STATUS:NEAR
						EXTRN SND_FM_WRITE_DATA:NEAR
						EXTRN SND_FM_READ_DATA:NEAR
						EXTRN SND_FM_WRITE_SAVE_ATA:NEAR
						EXTRN SND_FM_READ_SAVE_DATA:NEAR
						EXTRN SND_FM_TIMER_A_SET:NEAR
						EXTRN SND_FM_TIMER_B_SET:NEAR
						EXTRN SND_FM_TIMER_A_START:NEAR
						EXTRN SND_FM_TIMER_B_START:NEAR
						EXTRN SND_FM_LFO_SET:NEAR
						EXTRN SND_PCM_WAVE_TRANSFER:NEAR
						EXTRN SND_PCM_MODE_SET:NEAR
						EXTRN SND_PCM_SOUND_SET:NEAR
						EXTRN SND_PCM_SOUND_DELETE:NEAR
						EXTRN SND_PCM_REC_START:NEAR
						EXTRN SND_PCM_PCM_VOICE_PLAY:NEAR
						EXTRN SND_PCM_REC_STOP:NEAR
						EXTRN SND_PCM_PCM_VOICE_STOP:NEAR
						EXTRN SND_PCM_PCM_VOICE_STATUS:NEAR
						EXTRN SND_PCM_ABORT:NEAR
						EXTRN SND_PCM_PCMRAM_TO_MAINRAM:NEAR
						EXTRN SND_PCM_PCMRAM_TO_PCMRAM:NEAR
						EXTRN SND_PCM_TRANSFER2:NEAR
						EXTRN SND_PCM_HIGHRES_PLAY:NEAR
						EXTRN SND_FM_INIT:NEAR
						EXTRN SND_FM_REGWRITE:NEAR
						EXTRN SND_JOY_IN:NEAR
						EXTRN SND_JOY_IN_2:NEAR
						EXTRN SND_JOY_OUT:NEAR
						EXTRN SND_ELEVOL_SET:NEAR
						EXTRN SND_ELEVOL_INIT:NEAR
						EXTRN SND_ELEVOL_READ:NEAR
						EXTRN SND_ELEVOL_MUTE:NEAR
						EXTRN SND_ELEVOL_ALL_MUTE:NEAR
						EXTRN SND_ENVELOPE_INT_HANDLER:NEAR
						EXTRN SND_VOICE_INT_HANDLER:NEAR
						EXTRN SND_NOP:NEAR



SAVE_WORLD				MACRO
						PUSHF
						PUSH	FS
						PUSH	GS
						PUSH	ES
						PUSH	DS
						PUSHAD
						ENDM

RESTORE_WORLD			MACRO
						POPAD
						POP		DS
						POP		ES
						POP		GS
						POP		FS
						POPF
						ENDM

TSUGARU_BREAK			MACRO
						OUT		0EAH,AL
						ENDM

TSUGARU_STATUS			MACRO
						OUT		0EBH,AL
						ENDM

TGBIOS_SEG				EQU		0110H

CODE					SEGMENT

						DB		"TSUGARU BIOS",0

						ORG		20H
						DD		OFFSET EGB
						DW		TGBIOS_SEG

						ORG		40H
						DD		OFFSET MOS
						DW		TGBIOS_SEG

						ORG		60H
						DD		OFFSET SPR
						DW		TGBIOS_SEG

						ORG		80H
						DD		OFFSET SND
						DW		TGBIOS_SEG

						ORG		0A0H
						DD		OFFSET FNT
						DW		TGBIOS_SEG

						ORG		0C0H
						DD		OFFSET MIDI
						DW		TGBIOS_SEG

						ORG		1A0H
						DD		OFFSET SNDINT
						DW		TGBIOS_SEG

						ORG		1C0H
						DD		OFFSET SYSINFO
						DW		TGBIOS_SEG

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

						ORG		200H

EGB						PROC	FAR
						SAVE_WORLD

						CMP		AH,2FH
						JA		EGB_ABOVE_2FH

						MOVZX	EAX,AH
						CALL	DWORD PTR CS:[EGB_JUMPTABLE_00H_TO_2FH+EAX*4]
						JMP		EGB_EXIT

EGB_ABOVE_2FH:
						CMP		AH,51H
						JA		EGB_ABOVE_51H
						SUB		AH,40H
						JB		EGB_EXIT
						CALL	DWORD PTR CS:[EGB_JUMPTABLE_40H_TO_51H+EAX*4]
						JMP		EGB_EXIT

EGB_ABOVE_51H:
						CMP		AH,66H
						JA		EGB_EXIT
						SUB		AH,60H
						JB		EGB_EXIT
						CALL	DWORD PTR CS:[EGB_JUMPTABLE_60H_TO_66H+EAX*4]

EGB_EXIT:
						RESTORE_WORLD
						RET
EGB						ENDP

EGB_JUMPTABLE_00H_TO_2FH:
						DD EGB_INIT					; 00H
						DD EGB_RESOLUTION			; 01H
						DD EGB_DISPLAYSTART			; 02H
						DD EGB_VIEWPORT				; 03H
						DD EGB_PALETTE				; 04H
						DD EGB_WRITEPAGE			; 05H
						DD EGB_DISPLAYPAGE			; 06H
						DD EGB_COLOR				; 07H
						DD EGB_COLORIGRB			; 08H
						DD EGB_PASTEL				; 09H
						DD EGB_WRITEMODE			; 0AH
						DD EGB_LINEPATTERN			; 0BH
						DD EGB_PAINTMODE			; 0CH
						DD EGB_HATCHINGPATTERN		; 0DH
						DD EGB_TILEPATTERN			; 0EH
						DD EGB_MASKREGION			; 0FH
						DD EGB_MASK					; 10H
						DD EGB_PEN					; 11H
						DD EGB_PENSIZE				; 12H
						DD EGB_PENSTYLE				; 13H
						DD EGB_MASKBIT				; 14H
						DD EGB_TEXTDIRECTION		; 15H
						DD EGB_TEXTDISPLAYDIRECTION	; 16H
						DD EGB_TEXTSPACE			; 17H
						DD EGB_TEXTZOOM				; 18H
						DD EGB_FONTSTYLE			; 19H
						DD EGB_SUPERIMPOSE			; 1AH
						DD EGB_DIGITIZE				; 1BH
						DD EGB_RESOLUTION_BY_HANDLE	; 1CH
						DD EGB_UNSUPPORTED			; 1DH
						DD EGB_UNSUPPORTED			; 1EH
						DD EGB_UNSUPPORTED			; 1FH
						DD EGB_CLEARSCREEN			; 20H
						DD EGB_PARTCLEARSCREEN		; 21H
						DD EGB_GETBLOCKCOLOR		; 22H
						DD EGB_PUTBLOCKCOLOR		; 23H
						DD EGB_GETBLOCK				; 24H
						DD EGB_PUTBLOCK				; 25H
						DD EGB_GETBLOCKZOOM			; 26H
						DD EGB_PUTBLOCKZOOM			; 27H
						DD EGB_GRAPHICCURSOR		; 28H
						DD EGB_MASKDATA				; 29H
						DD EGB_SCROLL				; 2AH
						DD EGB_PARTSCROLL			; 2BH
						DD EGB_REGION				; 2CH
						DD EGB_COPY					; 2DH
						DD EGB_ROTATE				; 2EH
						DD EGB_RESOLVE				; 2FH

EGB_JUMPTABLE_40H_TO_51H:
						DD EGB_PSET					; 40H
						DD EGB_CONNECT				; 41H
						DD EGB_UNCONNECT			; 42H
						DD EGB_POLYGON				; 43H
						DD EGB_ROTATEPOLYGON		; 44H
						DD EGB_TRIANGLE				; 45H
						DD EGB_RECTANGLE			; 46H
						DD EGB_CIRCLE				; 47H
						DD EGB_ARC					; 48H
						DD EGB_FAN					; 49H
						DD EGB_ELLIPSE				; 4AH
						DD EGB_ELLIPTICARC			; 4BH
						DD EGB_ELLIPTICFAN			; 4CH
						DD EGB_PAINT				; 4DH
						DD EGB_CLOSEPAINT			; 4EH
						DD EGB_POINT				; 4FH
						DD EGB_BOW					; 50H
						DD EGB_BOW2					; 51H

EGB_JUMPTABLE_60H_TO_66H:
						DD EGB_SJISSTRING			; 60H
						DD EGB_CONNECTSJISSTRING	; 61H
						DD EGB_ASCIISTRING			; 62H
						DD EGB_CONNECTASCIISTRING	; 63H
						DD EGB_JISSTRING			; 64H
						DD EGB_CONNECTJISSTRING		; 65H
						DD EGB_ANYCHAR				; 66H

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

MOS						PROC	FAR
						RET
MOS						ENDP

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

SPR						PROC	FAR
						SAVE_WORLD

						CMP		AH,8
						JA		SPR_INVALID_REQUEST

						MOVZX	EAX,AH
						CALL	DWORD PTR CS:[SPR_JUMPTABLE+EAX*4]

						RESTORE_WORLD
						RET

SPR_INVALID_REQUEST:
						RESTORE_WORLD
						MOV		AH,BIOSERR_INVALID_REQUEST
						RET

SPR						ENDP

SPR_JUMPTABLE:
						DD SPR_INIT
						DD SPR_DISPLAY
						DD SPR_DEFINE
						DD SPR_SETPALETTEBLOCK
						DD SPR_SETPOSITION
						DD SPR_SETATTRIBUTE
						DD SPR_SETMOTION
						DD SPR_SETOFFSET
						DD SPR_READATTRIBUTE

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

SND						PROC	FAR
						SAVE_WORLD

						CMP		AH,0AH
						JA		SND_NOT_0AH
						MOVZX	EAX,AH
						CALL	DWORD PTR CS:[SND_JUMPTABLE_00H_TO_0AH+EAX*4]
						JMP		SND_EXIT

SND_NOT_0AH:
						CMP		AH,19H
						JA		SND_NOT_19H
						SUB		AH,10H
						MOVZX	EAX,AH
						CALL	DWORD PTR CS:[SND_JUMPTABLE_10H_TO_19H+EAX*4]
						JMP		SND_EXIT

SND_NOT_19H:
						CMP		AH,31H
						JA		SND_NOT_31H
						SUB		AH,20H
						MOVZX	EAX,AH
						CALL	DWORD PTR CS:[SND_JUMPTABLE_20H_TO_31H+EAX*4]
						JMP		SND_EXIT

SND_NOT_31H:
						CMP		AH,49H
						JA		SND_NOT_49H
						SUB		AH,40H
						MOVZX	EAX,AH
						CALL	DWORD PTR CS:[SND_JUMPTABLE_40H_TO_49H+EAX*4]
						JMP		SND_EXIT

SND_NOT_49H:
						CMP		AH,50H
						JNE		SND_NOT_50H
						CALL	SND_ENVELOPE_INT_HANDLER
						JMP		SND_EXIT

SND_NOT_50H:
						CMP		AH,51H
						JNE		SND_NOT_51H
						CALL	SND_VOICE_INT_HANDLER
						; JMP		SND_EXIT

SND_NOT_51H:
SND_EXIT:
						RESTORE_WORLD
						RET

SND_INVALID_REQUEST:
						RESTORE_WORLD
						MOV		AH,BIOSERR_INVALID_REQUEST
						RET

						RET
SND						ENDP

SND_JUMPTABLE_00H_TO_0AH:
						DD		SND_INIT
						DD		SND_KEY_ON
						DD		SND_KEY_OFF
						DD		SND_PAN_SET
						DD		SND_INST_CHANGE
						DD		SND_INST_WRITE
						DD		SND_INST_READ
						DD		SND_PITCH_CHANGE
						DD		SND_VOLUME_CHANGE
						DD		SND_KEY_ABORT
						DD		SND_STATUS

SND_JUMPTABLE_10H_TO_19H:
						DD		SND_FM_READ_STATUS
						DD		SND_FM_WRITE_DATA
						DD		SND_FM_READ_DATA
						DD		SND_FM_WRITE_SAVE_ATA
						DD		SND_FM_READ_SAVE_DATA
						DD		SND_FM_TIMER_A_SET
						DD		SND_FM_TIMER_B_SET
						DD		SND_FM_TIMER_A_START
						DD		SND_FM_TIMER_B_START
						DD		SND_FM_LFO_SET

SND_JUMPTABLE_20H_TO_31H:
						DD		SND_PCM_WAVE_TRANSFER
						DD		SND_PCM_MODE_SET
						DD		SND_PCM_SOUND_SET
						DD		SND_PCM_SOUND_DELETE
						DD		SND_PCM_REC_START
						DD		SND_PCM_PCM_VOICE_PLAY
						DD		SND_PCM_REC_STOP
						DD		SND_PCM_PCM_VOICE_STOP
						DD		SND_PCM_PCM_VOICE_STATUS
						DD		SND_PCM_ABORT
						DD		SND_PCM_PCMRAM_TO_MAINRAM
						DD		SND_PCM_PCMRAM_TO_PCMRAM
						DD		SND_PCM_TRANSFER2
						DD		SND_NOP
						DD		SND_PCM_HIGHRES_PLAY
						DD		SND_NOP
						DD		SND_FM_INIT
						DD		SND_FM_REGWRITE

SND_JUMPTABLE_40H_TO_49H:
						DD		SND_JOY_IN
						DD		SND_JOY_IN_2
						DD		SND_JOY_OUT
						DD		SND_ELEVOL_SET
						DD		SND_ELEVOL_INIT
						DD		SND_ELEVOL_READ
						DD		SND_ELEVOL_MUTE
						DD		SND_NOP
						DD		SND_NOP
						DD		SND_ELEVOL_ALL_MUTE


FNT						PROC	FAR
						RET
FNT						ENDP

MIDI					PROC	FAR
						RET
MIDI					ENDP

SNDINT					PROC	FAR
						RET
SNDINT					ENDP

SYSINFO					PROC	FAR
						RET
SYSINFO					ENDP

CODE					ENDS
						END
